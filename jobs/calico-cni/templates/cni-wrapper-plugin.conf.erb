<% unless p("cf_networking.disable") %>
<%=
  require 'json'

  OVERHEAD = 0

  def compute_mtu
    mtu = p('cf_networking.mtu')
    if mtu > 0
      return mtu - OVERHEAD
    else
      return mtu
    end
  end
  # "mtu" => compute_mtu,

  toRender = {
    "name" => "cni-wrapper",
    "type" => "cni-wrapper-plugin",
    "cniVersion" => "0.3.1",
    "datastore" => "/var/vcap/data/container-metadata/store.json",
    "iptables_lock_file" => "/var/vcap/data/garden-cni/iptables.lock",
    "delegate" => {
      "cniVersion" => "0.3.1",
      "name" => "calico",
      "type" => "calico",
      "ipam"=> {
        "type"=> "calico-ipam"
      }  
     }
  }

  JSON.pretty_generate(toRender)
%>
<% end %>
